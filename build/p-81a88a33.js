/*!
 * Â© Peculiar Ventures https://peculiarventures.com/ - MIT License
 */
import{A as t,e as s,C as e,N as r,E as i,f as n,g as o,h as a,j as h,R as u,k as c,l as m,m as f,n as l,o as g,p,q as E,r as b}from"./p-fe05f51e.js";import{b as C,D as A}from"./p-711b4e1e.js";import{d as w}from"./p-ec250cc4.js";
/**
 * @license
 * Copyright (c) Peculiar Ventures, LLC.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */class N extends t{constructor(t){super(s(t),e),this.thumbprints={},this.type="X.509 Certificate";const{tbsCertificate:i}=this.asn;this.serialNumber=C.Convert.ToHex(i.serialNumber),this.subject=new r(i.subject).toJSON(),this.issuer=new r(i.issuer).toJSON(),this.version=i.version+1;const n=i.validity.notBefore.utcTime||i.validity.notBefore.generalTime;if(!n)throw new Error("Cannot get 'notBefore' value");this.notBefore=n;const o=i.validity.notAfter.utcTime||i.validity.notAfter.generalTime;if(!o)throw new Error("Cannot get 'notAfter' value");this.notAfter=o,this.validity=w(this.notBefore,this.notAfter)}parseExtensions(){const{tbsCertificate:t}=this.asn;t.extensions&&(this.extensions=t.extensions.map((t=>new i(n.serialize(t)))))}getPublicKeyInfo(t){const{subjectPublicKey:s,algorithm:e}=t;let r;return e.algorithm===o&&e.parameters&&(r=n.parse(e.parameters,a)),e.algorithm===h&&(r=n.parse(s,u)),e.algorithm===c&&(r=n.parse(s,m),r=r.map((t=>this.getPublicKeyInfo(t)))),{params:r,value:n.serialize(t),algorithm:e.algorithm}}get publicKey(){return this.getPublicKeyInfo(this.asn.tbsCertificate.subjectPublicKeyInfo)}get signature(){const{signatureValue:t,signatureAlgorithm:s}=this.asn;let e;if(s.algorithm===f){const r=n.parse(t,l);e=n.parse(s.parameters,g).map(((t,s)=>Object.assign(Object.assign({},t),{value:r[s]})))}return{params:e,value:t,algorithm:s.algorithm}}exportAsBase64(){return C.Convert.ToBase64(this.raw)}exportAsHexFormatted(){return p(C.Convert.ToHex(this.raw))}exportAsPemFormatted(){return`-----BEGIN CERTIFICATE-----\n${E(this.exportAsBase64())}\n-----END CERTIFICATE-----`}async getThumbprint(t="SHA-1"){try{const s=await b(t,this.raw);s&&(this.thumbprints[t]=C.Convert.ToHex(s))}catch(t){console.error("Error thumbprint get:",t)}}get commonName(){if(!this.subject)return"";for(let t=0;t<this.subject.length;t+=1){const s=this.subject[t];if("CN"===s.shortName||"E"===s.shortName||"O"===s.shortName)return s.value}return""}get issuerCommonName(){if(!this.issuer)return"";for(let t=0;t<this.issuer.length;t+=1){const s=this.issuer[t];if("CN"===s.shortName)return s.value;if("E"===s.shortName)return s.value}return""}get isRoot(){return JSON.stringify(this.issuer)===JSON.stringify(this.subject)}subjectToString(){return this.subject?this.subject.map((t=>`${t.shortName}=${t.value}`)).join(", "):""}issuerToString(){return this.issuer?this.issuer.map((t=>`${t.shortName}=${t.value}`)).join(", "):""}downloadAsPEM(t){A.cert.asPEM(this.exportAsPemFormatted(),t||this.commonName)}downloadAsDER(t){A.cert.asDER(this.exportAsHexFormatted(),t||this.commonName)}}export{N as X}